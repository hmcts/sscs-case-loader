#!groovy
properties([
        [$class: 'GithubProjectProperty', projectUrlStr: 'https://github.com/hmcts/sscs-case-loader.git'],
        pipelineTriggers([[$class: 'GitHubPushTrigger']])
])

@Library("Infrastructure")

def type = "java"
def product = "sscs"
def app = "case-loader"


List<LinkedHashMap<String, Object>> secrets = [
  secret('MANAGEMENT_SECURITY_ENABLED', 'MANAGEMENT_SECURITY_ENABLED'),
  secret('CORE_CASE_DATA_API_URL', 'CORE_CASE_DATA_API_URL'),
  secret('CORE_CASE_DATA_USER_ID', 'CORE_CASE_DATA_USER_ID'),
  secret('CORE_CASE_DATA_JURISDICTION_ID', 'CORE_CASE_DATA_JURISDICTION_ID'),
  secret('CORE_CASE_DATA_CASE_TYPE_ID', 'CORE_CASE_DATA_CASE_TYPE_ID'),
  secret('CORE_CASE_DATA_EVENT_ID', 'CORE_CASE_DATA_EVENT_ID'),
  secret('IDAM_URL', 'IDAM_URL'),
  secret('IDAM.S2S-AUTH.TOTP_SECRET', 'IDAM.S2S-AUTH.TOTP_SECRET'),
  secret('IDAM.S2S-AUTH', 'IDAM.S2S-AUTH'),
  secret('IDAM.S2S-AUTH.MICROSERVICE', 'IDAM.S2S-AUTH.MICROSERVICE'),
  secret('IDAM_SSCS_SYSTEMUPDATE_USER', 'IDAM_SSCS_SYSTEMUPDATE_USER'),
  secret('IDAM_SSCS_SYSTEMUPDATE_PASSWORD', 'IDAM_SSCS_SYSTEMUPDATE_PASSWORD')
  secret('IDAM_OAUTH2_CLIENT_ID','IDAM_OAUTH2_CLIENT_ID')
  secret('IDAM_OAUTH2_CLIENT_SECRET','IDAM_OAUTH2_CLIENT_SECRET')
  secret('IDAM_OAUTH2_REDIRECT_URL','IDAM_OAUTH2_REDIRECT_URL')
  secret('GAPS2_KEY_LOCATION','GAPS2_KEY_LOCATION')
  secret('GAPS2_SFTP_HOST','GAPS2_SFTP_HOST')
  secret('GAPS2_SFTP_PORT','GAPS2_SFTP_PORT')
  secret('GAPS2_SFTP_USER','GAPS2_SFTP_USER')
  secret('GAPS2_SFTP_DIR','GAPS2_SFTP_DIR')
  secret('SSCS_CASE_LOADER_CRON_SCHEDULE','SSCS_CASE_LOADER_CRON_SCHEDULE')
  secret('IGNORE_CASES_BEFORE_DATE','IGNORE_CASES_BEFORE_DATE')
]

static LinkedHashMap<String, Object> secret(String secretName, String envVar) {
  [ $class: 'AzureKeyVaultSecret',
    secretType: 'Secret',
    name: secretName,
    version: '',
    envVariable: envVar
  ]
}


withPipeline(type, product, app) {
    enableSlackNotifications('#sscs-tech')
}

